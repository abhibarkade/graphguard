# ------------------------------------------------------
# THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
# ------------------------------------------------------

"""Customer represents an external tenant"""
type Customer {
  createdAt: DateTime!
  externalId: String
  id: ID!
  name: String!
  project: Project!
  variants: [Variant!]!
}

"""
A date-time string at UTC, such as 2019-12-03T09:54:33Z, compliant with the date-time format.
"""
scalar DateTime

"""Deployment attempt record"""
type Deployment {
  failureReason: String
  finishedAt: DateTime
  id: ID!
  schemaVersion: SchemaVersion!
  schemaVersionId: String!
  startedAt: DateTime!
  status: DeploymentStatus!
  variant: Variant!
  variantId: String!
}

enum DeploymentStatus {
  FAILED
  IN_PROGRESS
  PENDING
  ROLLED_BACK
  SUCCEEDED
}

type Mutation {
  checkSchema(schemaSDL: String!, variantId: ID!): SchemaValidationResult!
  createCustomer(externalId: String, name: String!, projectId: ID!): Customer!
  createOrganization(name: String!): Organization!
  createProject(name: String!, organizationId: ID!): Project!
  createVariant(customerId: ID!, name: String!): Variant!
  deploySchema(dryRun: Boolean! = false, schemaName: String!, schemaSDL: String!, variantId: ID!, versionLabel: String!): Deployment!
  rollbackSchema(targetSchemaVersionId: ID!, variantId: ID!): Deployment!
}

type Organization {
  createdAt: DateTime!
  id: ID!
  name: String!
  projects: [Project!]!
}

type Project {
  createdAt: DateTime!
  customers: [Customer!]!
  id: ID!
  name: String!
  organization: Organization!
}

type Query {
  activeSchema(variantId: ID!): SchemaVersion
  customer(id: ID!): Customer
  customerByExternalId(externalId: String!, projectId: ID!): Customer
  deployments(variantId: ID!): [Deployment!]!
  health: String!
  organization(id: ID!): Organization
  organizations: [Organization!]!
  project(id: ID!): Project
  schemaHistory(schemaId: ID!): [SchemaVersion!]!
  variant(id: ID!): Variant
  variantByPath(customerExternalId: String!, projectName: String!, variantName: String!): Variant
}

"""Logical schema identity"""
type Schema {
  activeVersion: SchemaVersion
  createdAt: DateTime!
  id: ID!
  name: String!
  variant: Variant!
  versions: [SchemaVersion!]!
}

type SchemaValidationResult {
  errors: [ValidationError!]!
  isValid: Boolean!
}

"""Immutable schema content"""
type SchemaVersion {
  checksum: String!
  createdAt: DateTime!
  id: ID!
  schema: Schema!
  schemaSDL: String!
  status: SchemaVersionStatus!
  versionLabel: String
  versionOrder: Int!
}

enum SchemaVersionStatus {
  ACTIVE
  DEPRECATED
  DRAFT
  ROLLED_BACK
  VALIDATED
}

type ValidationError {
  code: String!
  message: String!
  path: String
}

"""Variant is the isolation boundary (dev / uat / prod)"""
type Variant {
  createdAt: DateTime!
  customer: Customer!
  deployments: [Deployment!]!
  id: ID!
  name: String!
  schemas: [Schema!]!
}